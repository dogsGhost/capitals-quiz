// Generated by CoffeeScript 1.6.1
/*
* @fileOverview This file makes our quiz work.
* @author David Wilhelm
*/(function(){var e;e={init:function(){this.cacheVariables();return this.bindQuizList()},cacheVariables:function(){this.quizFormTemplate=Handlebars.compile($("#quiz-form-template").html());this.resultsTemplate=Handlebars.compile($("#results-template").html());this.$container=$(".container");this.$initContent=[];this.$quizForm=$("#quiz-form");this.answerKey=[];this.userAnswers=[];this.numberAnswered=0;this.totalQuestions=0;this.invalidForm=!1;this.qSetLength=3},bindQuizList:function(){return $("#quizList").on("click","a",this.determineQuiz)},determineQuiz:function(t){t.preventDefault();if(this.id==="usa")return $.getJSON("js/statesAnswerKey.json",e.createAnswerKey);if(this.id==="canada")return!1},createAnswerKey:function(t){var n,r,i,s;n=e.shuffle(t);for(i=0,s=n.length;i<s;i++){r=n[i];r.cities=e.shuffle(r.cities);r.cities=r.cities.splice(2,2);r.cities.push(r.capital);r.cities=e.shuffle(r.cities)}e.answerKey=n;e.totalQuestions=e.answerKey.length;return e.loadUsaQuiz()},loadUsaQuiz:function(){var e;this.$initContent=this.$container.children().detach();this.$container.append(this.$initContent[3]);e=this.createQuestionSet();this.$quizForm.on("submit",this.processForm);return this.$quizForm.find("div").html(e).end().show()},createQuestionSet:function(){var e;e={states:this.answerKey.slice(this.numberAnswered,this.numberAnswered+this.qSetLength),answered:this.numberAnswered,total:this.totalQuestions,percentage:""+String(Math.round(this.numberAnswered/this.totalQuestions*100))+"%"};return this.quizFormTemplate(e)},processForm:function(t){var n,r,i,s;t.preventDefault();n=$(this).serializeArray();e.validateForm(n);if(!e.invalidForm){for(i=0,s=n.length;i<s;i++){r=n[i];e.userAnswers.push(r)}e.numberAnswered+=e.qSetLength;navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?window.scroll(0,0):$("html, body").animate({scrollTop:0},600);return e.numberAnswered>=e.totalQuestions?e.showResults():e.showNextSet()}},validateForm:function(e){var t,n,r,i;this.invalidForm=!1;t="<div class='question__no-answer'>      <p>Please select a capital for this state.</p>      </div>";$(".question__no-answer").remove();for(r=0,i=e.length;r<i;r++){n=e[r];if(!n.value){$(".question--"+n.name).prepend(t);this.invalidForm=!0}}},showNextSet:function(){var t;t=this.createQuestionSet();this.$quizForm.find("div").html(t);if(e.numberAnswered>=e.totalQuestions-e.qSetLength)return this.$quizForm.find("input[type=submit]").val("View Results \u27a1")},showResults:function(){var e,t,n,r,i,s,o,u,a,f;n={total:this.totalQuestions,wrong:[]};a=this.userAnswers;for(i=0,o=a.length;i<o;i++){e=a[i];f=this.answerKey;for(s=0,u=f.length;s<u;s++){r=f[s];if(e.name===r.abbr&&e.value!==r.capital){n.wrong.push(r);break}}}n.correct=n.total-n.wrong.length;n.score=""+String(Math.round(n.correct/n.total*100))+"%";t=this.resultsTemplate(n);this.$quizForm.find("div").empty().end().remove();this.$container.html(t);return $(".btn--new-game").on("click",function(){return location.reload()})},shuffle:function(e){var t,n,r,i;t=e.length;if(t===0)return!1;while(--t){n=Math.floor(Math.random()*(t+1));r=e[t];i=e[n];e[t]=i;e[n]=r}return e}};e.init()}).call(this);